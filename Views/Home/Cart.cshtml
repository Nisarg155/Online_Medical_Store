@inject hospital.Models.AppDbContext Db
@{
    Layout = null;
}

<html lang="en">

<head>
    @Html.Partial("_head_tags")
    <link href="~/Content/template/css/cart.css" rel="stylesheet"/>
    <script type="text/javascript" src="~/Content/template/js/cart.js"></script>
</head>

<body class="sub_page">
    <div class="hero_area">
        <!-- header section strats -->
        @Html.Partial("_navbar")

        <!-- end header section -->
    </div>
    <main>
        <div class="basket">

            <div class="basket-labels">
                <ul>
                    <li class="item item-heading">Item</li>

                    <li class="price">Price</li>
                    <li class="quantity">Quantity</li>
                    <li class="subtotal">Subtotal</li>

                </ul>
            </div>
            <div class="basket-product">
                @{
                    int? total = 0;
                }

                @foreach (var item2 in Model)
                {

                    <div class="item">
                        <div class="product-image">
                            <img src="~/images/@item2.image" alt="Placholder Image 2" class="product-frame">
                        </div>
                        <div class="product_name">

                            <p><strong>@item2.name</strong></p>
                        </div>
                    </div>

                    <div class="price" id="price-@item2.Cid">@item2.price</div>
                    <div class="quantity">
                        <input type="number" value="1" min="1" id="qnt-@item2.Cid" class="quantity-field">

                    </div>
                    <div class="subtotal" id="subtotal-@item2.Cid">@item2.bil</div>
                    total = total + @item2.bil;
                    <div class="remove">

                        <a class="remove" href="@Url.Action("Delete",new { id = item2.Cid })">Remove</a>
                    </div>
                }
            </div>

        </div>
        <aside>
            <div class="summary">
                <div class="summary-total-items"><span class="total-items"></span> Items in your Bag</div>
                <div class="summary-subtotal">
                    <div class="subtotal-title">Subtotal</div>
                    <div class="subtotal-value final-value" id="basket-subtotal">@total</div>
                    <div class="summary-promo hide">
                        <div class="promo-title">Promotion</div>
                        <div class="promo-value final-value" id="basket-promo"></div>
                    </div>
                </div>
                <div class="summary-delivery">
                    <select name="delivery-collection" class="summary-delivery-selection">
                        <option value="0" selected="selected">Select Collection or Delivery</option>
                        <option value="collection">Collection</option>
                        <option value="first-class">Royal Mail 1st Class</option>
                        <option value="second-class">Royal Mail 2nd Class</option>
                        <option value="signed-for">Royal Mail Special Delivery</option>
                    </select>
                </div>
                <div class="summary-total">
                    <div class="total-title">Total</div>
                    <div class="total-value final-value" id="basket-total">@total</div>
                </div>
                <div class="summary-checkout">
                    @*<button class="checkout-cta">Go to Secure Checkout</button>*@
                    @{
                        string url = "https://WWW.sandbox.paypal.com/cgi-bin/webscr?cmd=_xclick&amount=" + (@total) + "&business=JanjuaTailors@Shop.com&item_name=Medicine&return=Page";

                    }
                    @if (@total == 0)
                    {
                        <h5 style="color:dodgerblue">Opps, Your cart is empty !!</h5>
                    }
                    else
                    {
                        <a href="@url" class="aa-cart-view-btn">Go to Secure Checkout</a>
                    }

                </div>
            </div>
        </aside>
    </main>
    <!-- ... (your existing HTML code) ... -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Function to update subtotal for a specific item
            function updateItemSubtotal(itemId) {
                var quantity = $('#qnt-' + itemId);
                //console.log(quan)
                console.log(quantity);
                var price = parseFloat($('#price-' + itemId).text());
                //console.log(price);
                var subtotal = quantity * price;
                //console.log(subtotal);
                $('#subtotal-' + itemId).text(subtotal.toFixed(2));
                //console.log("Hello");
                return subtotal;
            }

            // Function to update total amount
            function updateTotalAmount() {
                var newTotal = 0;
                $('.basket-product .item').each(function () {
                    var itemId = $(this).attr('data-item-id');
                    var subtotal = updateItemSubtotal(itemId);
                    newTotal += subtotal;
                });
                $('#basket-subtotal, #basket-total').text(newTotal.toFixed(2));
            }

            // Attach event listener to quantity fields
            $('.quantity-field').on('input', function () {
                var itemId = $(this).closest('.item').attr('data-item-id');
                console.log(itemId);
                updateItemSubtotal(itemId);
                updateTotalAmount();
            });
            updateTotalAmount();
        });
    </script>

    @Html.Partial("_footer")

</body>

</html>

